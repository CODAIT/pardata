#
# Copyright 2020 IBM Corp. All Rights Reserved.
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
#

environment:
  matrix:
    - TOXENV: py36
      APPVEYOR_BUILD_WORKER_IMAGE: "Visual Studio 2013"
    - TOXENV: py37
      # Because MacOS and Linux are quite similar for our purposes, we only test one Python version on MacOS
      # to avoid surprise and conserve resource (we have only 1 test running concurrently on AppVeyor).'
 
      # We put this test right after the first Windows test because we only have 1 test running concurrently, and this
      # is the test that is the most likely to fail after the first Windows test has passed, because it is very
      # different from Windows.
      APPVEYOR_BUILD_WORKER_IMAGE: macOS
    - TOXENV: py37
      APPVEYOR_BUILD_WORKER_IMAGE: "Visual Studio 2015"
    - TOXENV: py38
      APPVEYOR_BUILD_WORKER_IMAGE: "Visual Studio 2017"
    - TOXENV: py39
      APPVEYOR_BUILD_WORKER_IMAGE: "Visual Studio 2019"

matrix:
  allow_failures:
    # TODO: We allow windows test to fail for now, so that we can work on to eliminate the failures by
    # observing the output of the CI. This must be removed eventually.
    - os: win32

build: off

install:
- pip3 install tox

test_script:
- tox -vv

branches:
  only:
    - master
